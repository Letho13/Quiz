<div class="profile-container container">
  <h1 class="page-title">Mon Profil</h1>

  <div class="profile-layout">

    <section class="user-info card">
      <h2>Vos Informations</h2>

      @if (user$ | async; as user) {
        <div class="info-details">
          <div class="info-item">
            <strong>Nom dâ€™utilisateur :</strong>
            <span>{{ user.username }}</span>
          </div>
          <div class="info-item">
            <strong>Email :</strong>
            <span>{{ user.email }}</span>
          </div>

          <button class="btn-primary edit-button" (click)="openEditModal()">
            Modifier mes infos
          </button>
        </div>
      }
    </section>

    <section class="user-scores card">
      <h2>ðŸ“Š Mes Meilleurs Scores</h2>

      <div class="scores-table-wrapper">
        <table class="scores-table">
          <thead>
          <tr>
            <th>Quiz</th>
            <th>Score Obtenu</th>
          </tr>
          </thead>
          <tbody>

            @for (s of scores$ | async; track s.quizTitle) {
              <tr>
                <td class="quiz-title-cell">{{ s.quizTitle }}</td>
                <td class="score-value-cell">{{ s.score }}</td>
              </tr>
            }

            @empty {
              <tr>
                <td colspan="2" class="no-score-message">
                  Vous n'avez pas encore de scores enregistrÃ©s.
                </td>
              </tr>
            }

          </tbody>
        </table>
      </div>

    </section>
  </div>
</div>

@if (showEditModal) {
  <div class="modal-overlay">
    <div class="modal">
      <h3>Modifier mes informations</h3>
      <form [formGroup]="editForm" (ngSubmit)="saveChanges()">

        <label>
          Nom d'utilisateur
          <input formControlName="username" placeholder="Nom d'utilisateur">
        </label>
        @if (editForm.get('username')?.invalid && editForm.get('username')?.touched) {
          <div class="form-error">
            Nom trop court (min 3).
          </div>
        }

        <label>
          Email
          <input formControlName="email" placeholder="email@example.com">
        </label>
        @if (editForm.get('email')?.invalid && editForm.get('email')?.touched) {
          <div class="form-error">
            Email invalide.
          </div>
        }

        <label>
          Nouveau mot de passe (optionnel)
          <input type="password" formControlName="password" placeholder="Nouveau mot de passe">
        </label>
        @if (editForm.get('password')?.invalid && editForm.get('password')?.touched) {
          <div class="form-error">
            Le mot de passe doit faire â‰¥8 caractÃ¨res, contenir une majuscule, un chiffre et un caractÃ¨re spÃ©cial.
          </div>
        }

        <label>
          Confirmer mot de passe
          <input type="password" formControlName="confirmPassword" placeholder="Confirmer mot de passe">
        </label>
        @if (editForm.get('confirmPassword')?.errors?.['passwordsMismatch']) {
          <div class="form-error">
            Les mots de passe ne correspondent pas.
          </div>
        }

        <div class="modal-actions">
          <button type="submit" class="btn-primary" [disabled]="editForm.invalid">Enregistrer</button>
          <button type="button" class="btn-secondary" (click)="cancelEdit()">Annuler</button>
        </div>
      </form>
    </div>
  </div>
}
