<div class="profile-container">
  <h2>ðŸ‘¤ Mon Profil</h2>

  <!-- Infos utilisateur -->
  <section class="user-info" *ngIf="user$ | async as user">
    <p><strong>Nom dâ€™utilisateur :</strong> {{ user.username }}</p>
    <p><strong>Email :</strong> {{ user.email }}</p>
    <button class="btn-primary" (click)="openEditModal()">Modifier mes infos</button>
  </section>

  <!-- Scores -->
  <section class="user-scores">
    <h3>ðŸ“Š Mes Meilleurs Scores</h3>
    <table>
      <thead>
      <tr>
        <th>Quiz</th>
        <th>Score</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let s of scores$ | async">
        <td>{{ s.quizTitle }}</td>
        <td>{{ s.score }}</td>
      </tr>
      <tr *ngIf="(scores$ | async)?.length === 0">
        <td colspan="2">Aucun score</td>
      </tr>
      </tbody>
    </table>
  </section>
</div>

<div class="modal-overlay" *ngIf="showEditModal">
  <div class="modal">
    <h3>Modifier mes informations</h3>
    <form [formGroup]="editForm" (ngSubmit)="saveChanges()">

      <label>
        Nom d'utilisateur
        <input formControlName="username" placeholder="Nom d'utilisateur">
      </label>
      <div *ngIf="editForm.get('username')?.invalid && editForm.get('username')?.touched">
        Nom trop court (min 3).
      </div>

      <label>
        Email
        <input formControlName="email" placeholder="email@example.com">
      </label>
      <div *ngIf="editForm.get('email')?.invalid && editForm.get('email')?.touched">
        Email invalide.
      </div>

      <label>
        Nouveau mot de passe (optionnel)
        <input type="password" formControlName="password" placeholder="Nouveau mot de passe">
      </label>
      <div *ngIf="editForm.get('password')?.invalid && editForm.get('password')?.touched">
        Le mot de passe doit faire â‰¥8 caractÃ¨res, contenir une majuscule, un chiffre et un caractÃ¨re spÃ©cial.
      </div>

      <label>
        Confirmer mot de passe
        <input type="password" formControlName="confirmPassword" placeholder="Confirmer mot de passe">
      </label>
      <div *ngIf="editForm.get('confirmPassword')?.errors?.['passwordsMismatch']">
        Les mots de passe ne correspondent pas.
      </div>

      <div class="modal-actions">
        <button type="submit" [disabled]="editForm.invalid">Enregistrer</button>
        <button type="button" (click)="cancelEdit()">Annuler</button>
      </div>
    </form>
  </div>
</div>
