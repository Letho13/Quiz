<div class="register-container">
  <h2>Créer un compte</h2>

  <form [formGroup]="registerForm" (ngSubmit)="onRegister()">

    <!-- Username -->
    <label>
      <input formControlName="username" placeholder="Nom d'utilisateur" />
    </label>
    @if (registerForm.get('username')?.invalid && registerForm.get('username')?.touched) {
      <div class="error">Le nom doit contenir au moins 3 caractères.</div>
    }

    <!-- Email -->
    <label>
      <input formControlName="email" placeholder="email@example.com" />
    </label>
    @if (registerForm.get('email')?.invalid && registerForm.get('email')?.touched) {
      <div class="error">Email invalide.</div>
    }

    <!-- Password -->
    <label>
      <div class="password-wrapper">
        <input
          [type]="showPassword ? 'text' : 'password'"
          formControlName="password"
          placeholder="Mot de passe"
        />
        <button type="button" class="toggle-password" (click)="togglePasswordVisibility('password')">
          <!-- Icônes SVG de l'œil (visible/masqué) -->
          @if (showPassword) {
            <!-- Oeil ouvert (Eye) -->
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
          } @else {
            <!-- Oeil barré (EyeOff) -->
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.11 13.11 0 0 0 4 12s3 7 10 7c.76 0 1.5-1.5 2.5-3"/><line x1="2" x2="22" y1="2" y2="22"/></svg>
          }
        </button>
      </div>
    </label>

    @if (registerForm.get('password')?.errors && registerForm.get('password')?.touched) {
      <div class="error">
        <p>Le mot de passe doit respecter les règles suivantes :</p>
        <ul>
          @if (registerForm.get('password')?.errors?.['minLength']) {
            <li>{{ registerForm.get('password')?.errors?.['minLength'] }}</li>
          }
          @if (registerForm.get('password')?.errors?.['uppercase']) {
            <li>{{ registerForm.get('password')?.errors?.['uppercase'] }}</li>
          }
          @if (registerForm.get('password')?.errors?.['digit']) {
            <li>{{ registerForm.get('password')?.errors?.['digit'] }}</li>
          }
          @if (registerForm.get('password')?.errors?.['special']) {
            <li>{{ registerForm.get('password')?.errors?.['special'] }}</li>
          }
        </ul>
      </div>
    }

    <!-- Confirm Password -->
    <label>
      <div class="password-wrapper">
        <input
          [type]="showConfirmPassword ? 'text' : 'password'"
          formControlName="confirmPassword"
          placeholder="Confirmer mot de passe"
        />
        <button type="button" class="toggle-password" (click)="togglePasswordVisibility('confirmPassword')">
          @if (showConfirmPassword) {
            <!-- Oeil ouvert (Eye) -->
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
          } @else {
            <!-- Oeil barré (EyeOff) -->
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.11 13.11 0 0 0 4 12s3 7 10 7c.76 0 1.5-1.5 2.5-3"/><line x1="2" x2="22" y1="2" y2="22"/></svg>
          }
        </button>
      </div>
    </label>
    @if (registerForm.hasError('passwordsMismatch') && registerForm.get('confirmPassword')?.touched) {
      <div class="error">Les mots de passe ne correspondent pas.</div>
    }

    <!-- Error global -->
    @if (error) {
      <div class="error-message">{{ error }}</div>
    }

    <!-- Actions -->
    <div class="actions">
      <button type="submit" [disabled]="registerForm.invalid">Créer mon compte</button>
      <a routerLink="/auth/login">Déjà un compte ? Connectez-vous</a>
    </div>
  </form>
</div>
